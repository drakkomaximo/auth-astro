---
import AuthLayout from "../layouts/AuthLayout.astro";

const email = Astro.cookies.get("email")?.value ?? "";
const remember_me = !!email;
---

<AuthLayout title="Register">
    <div class="mb-4">
        <h3 class="font-semibold text-2xl text-gray-800">Create Account</h3>
        <p class="text-gray-500">
            Please fill in your information to create an account.
        </p>
    </div>
    <form class="space-y-5">
        <div class="space-y-2">
            <label
                class="text-sm font-medium text-gray-700 tracking-wide"
                for="name"
            >
                Full Name
            </label>
            <input
                id="name"
                name="name"
                class="w-full text-base px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-green-400"
                type="text"
                placeholder="John Doe"
                required
            />
        </div>
        <div class="space-y-2">
            <label
                class="text-sm font-medium text-gray-700 tracking-wide"
                for="email"
            >
                Email
            </label>
            <input
                id="email"
                name="email"
                class="w-full text-base px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-green-400"
                type="email"
                placeholder="mail@gmail.com"
                value={email}
                required
            />
        </div>
        <div class="space-y-2">
            <label
                class="mb-5 text-sm font-medium text-gray-700 tracking-wide"
                for="password"
            >
                Password
            </label>
            <input
                id="password"
                name="password"
                class="w-full content-center text-base px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-green-400"
                type="password"
                placeholder="Enter your password"
                required
            />
        </div>
        <div class="flex items-center">
            <input
                id="remember_me"
                name="remember_me"
                type="checkbox"
                class="h-4 w-4 bg-green-500 focus:ring-green-400 border-gray-300 rounded checked:bg-green-500"
                checked={remember_me}
                required
            />
            <label for="remember_me" class="ml-2 block text-sm text-gray-800">
                Remember me
            </label>
        </div>
        <div>
            <button
                id="btn-submit"
                type="submit"
                class="disabled:opacity-50 disabled:cursor-not-allowed w-full flex justify-center bg-green-400 hover:bg-green-500 text-gray-100 p-3 rounded-full tracking-wide font-semibold shadow-lg cursor-pointer transition ease-in duration-500"
            >
                Create Account
            </button>
        </div>
    </form>
    <div class="pt-5 text-center text-gray-400 text-xs">
        <span>
            Already have an account?
            <a href="/login" class="text-green-400 hover:text-green-500">
                Sign in here
            </a>
        </span>
    </div>
</AuthLayout>

<script>
    import { actions } from "astro:actions";
    import Swal from "sweetalert2";

    const form = document.querySelector("form") as HTMLFormElement;
    const btbSubmit = document.querySelector(
        "#btn-submit",
    ) as HTMLButtonElement;

    form.addEventListener("submit", async (e) => {
        e.preventDefault();
        btbSubmit.setAttribute("disabled", "disabled");

        const formData = new FormData(form);

        const { data, error } = await actions.registerUser(formData);

        if (error) {
            console.error(error.message);
            Swal.fire({
                icon: "error",
                title: "Oops...",
                text: error.message,
            });
            btbSubmit.removeAttribute("disabled");
            return;
        }

        window.location.replace("/protected");
    });
</script>
